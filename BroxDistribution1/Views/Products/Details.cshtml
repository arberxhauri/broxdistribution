@model BroxDistribution.Models.Wine

@{
    ViewData["Title"] = Model?.Name ?? "Wine Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container" style="padding: 60px 0 100px; padding-top: 150px">
    <a asp-action="Index" class="btn btn-outline-gold mb-4">
        <i class="bi bi-arrow-left me-2"></i>Back to Portfolio
    </a>

    <div class="row g-5">
        <!-- Image Section -->
        <div class="col-lg-5">
            <div class="product-image-wrapper">
                @if (!string.IsNullOrEmpty(Model.ImageUrl))
                {
                    <img src="@Model.ImageUrl" class="product-image" alt="@Model.Name" />
                }
                else
                {
                    <div class="product-image-placeholder">
                        <i class="bi bi-wine-glass"></i>
                    </div>
                }
            </div>
        </div>

        <!-- Details Section -->
        <div class="col-lg-7">
            <div class="glass-card p-5">
                <!-- Badges -->
                <div class="d-flex flex-wrap gap-2 mb-4">
                    @if (!string.IsNullOrEmpty(Model.Category))
                    {
                        <span class="badge badge-gold px-3 py-2" style="font-size: 0.8rem;">
                            <i class="bi bi-tag me-1"></i>@Model.Category
                        </span>
                    }
                    @if (!string.IsNullOrEmpty(Model.Country))
                    {
                        <span class="badge badge-wine px-3 py-2" style="font-size: 0.8rem;">
                            <i class="bi bi-geo-alt me-1"></i>@Model.Country
                        </span>
                    }
                    @if (!string.IsNullOrEmpty(Model.Region))
                    {
                        <span class="badge badge-wine px-3 py-2" style="font-size: 0.8rem;">@Model.Region</span>
                    }
                </div>

                <!-- Title -->
                <h1 class="display-4 brand-serif mb-2" style="font-weight: 400;">@Model.Name</h1>
                <p class="fs-4 text-muted mb-4" style="font-weight: 400;">@Model.Brand</p>

                <!-- CTA Section - Moved Up -->
                <div class="text-center mb-5 p-4" style="background: linear-gradient(135deg, rgba(133, 32, 50, 0.05), rgba(204, 153, 51, 0.05)); border-radius: 12px; border: 2px solid var(--warm-gold);">
                    <p class="text-muted mb-3" style="font-size: 1rem; font-weight: 500;">
                        <i class="bi bi-star-fill me-2" style="color: var(--warm-gold);"></i>Interested in this wine?
                    </p>
                    <a asp-controller="Home" 
                       asp-action="Contact" 
                       asp-route-wine="@Model.Name"
                       asp-route-brand="@Model.Brand"
                       asp-route-category="@Model.Category"
                       asp-route-year="@Model.Year"
                       asp-route-country="@Model.Country"
                       class="btn btn-wine btn-lg" style="padding: 16px 40px;">
                        <i class="bi bi-envelope me-2"></i>Request Quote
                    </a>
                </div>

                <div class="divider-gold mb-5"></div>

                <!-- Specifications Grid -->
                <div class="row g-3 mb-5">
                    <div class="col-md-6">
                        <div class="spec-card">
                            <div class="spec-label">
                                <i class="bi bi-droplet me-1"></i>Grape Variety
                            </div>
                            <div class="spec-value">
                                @(!string.IsNullOrEmpty(Model.Grape) ? Model.Grape : "N/A")
                            </div>
                        </div>
                    </div>
                    @if (Model.Year > 0)
                    {
                        <div class="col-md-3">
                            <div class="spec-card">
                                <div class="spec-label">
                                    <i class="bi bi-calendar3 me-1"></i>Vintage
                                </div>
                                <div class="spec-value">
                                    @Model.Year
                                </div>
                            </div>
                        </div>   
                    }
                    <div class="col-md-3">
                        <div class="spec-card">
                            <div class="spec-label">
                                <i class="bi bi-percent me-1"></i>ABV
                            </div>
                            <div class="spec-value">@Model.AlcoholPercentage%</div>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <div class="mb-5">
                        <h4 class="brand-serif mb-3" style="font-size: 1.8rem; font-weight: 400;">
                            <i class="bi bi-journal-text me-2" style="color: var(--warm-gold);"></i>
                            Tasting Notes
                        </h4>
                        <div class="tasting-note">
                            <p class="mb-0" style="font-size: 1.05rem; line-height: 1.8; color: var(--charcoal);">@Model.Description</p>
                        </div>
                    </div>
                }
                
                <!-- Detailed Tasting Notes -->
                @if (!string.IsNullOrEmpty(Model.TastingNotesJson))
                {
                    try
                    {
                        var tastingNotes = System.Text.Json.JsonSerializer.Deserialize<List<Dictionary<string, string>>>(Model.TastingNotesJson);
                        if (tastingNotes != null && tastingNotes.Any())
                        {
                            <div class="mb-4">
                                <h4 class="brand-serif mb-4" style="font-size: 1.8rem; font-weight: 400;">
                                    <i class="bi bi-clipboard-data me-2" style="color: var(--warm-gold);"></i>
                                    Wine Profile
                                </h4>
                                <div class="row g-3">
                                    @foreach (var note in tastingNotes)
                                    {
                                        <div class="col-12">
                                            <div class="spec-card">
                                                <div class="spec-label" style="font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem;">
                                                    <i class="bi bi-check-circle me-1" style="color: var(--warm-gold); font-size: 0.9rem;"></i>
                                                    @note["label"]
                                                </div>
                                                <div class="spec-value" style="font-size: 1rem; font-weight: 400; color: var(--charcoal); line-height: 1.6;">
                                                    @note["value"]
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    }
                    catch
                    {
                        <!-- Silently fail if JSON parsing fails -->
                    }
                }
            </div>
        </div>
    </div>
</div>

<script type="application/ld+json">
{
  "@@context": "https://schema.org",
  "@@type": "Product",
  "name": "@Model.Name",
  "description": "@Html.Raw(System.Net.WebUtility.HtmlEncode(Model.Description ?? ""))",
  "image": "@Model.ImageUrl",
  "brand": {
    "@@type": "Brand",
    "name": "@Model.Brand"
  },
  "category": "@Model.Category",
  "productionDate": "@(Model.Year > 0 ? Model.Year.ToString() : "")",
  "countryOfOrigin": "@Model.Country",
  "offers": {
    "@@type": "Offer",
    "availability": "https://schema.org/InStock",
    "price": "0",
    "priceCurrency": "GBP"
  }
}
</script>
