@model IEnumerable<BroxDistribution.Models.Wine>

@{
    ViewData["Title"] = "Wine Portfolio";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Header -->
<section style="padding: 80px 0 60px; background: var(--soft-cream); border-bottom: 1px solid var(--light-gray);">
    <div class="container">
        <div class="text-center">
            <h1 class="section-title" style="font-size: 4rem; margin-bottom: 20px;">Our Collection</h1>
            <p class="section-subtitle" style="font-size: 1.1rem; margin-bottom: 0;">
                Discover exceptional wines from the world's finest estates
            </p>
        </div>
    </div>
</section>

<div class="container" style="margin-top: -40px; margin-bottom: 100px;">
    <!-- Single Search Filter -->
    <div class="glass-card p-4 mb-5" style="box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);">
        <form method="get">
            <div class="row g-3 align-items-center">
                <div class="col-lg-10 col-md-9">
                    <div class="search-wrapper">
                        <input type="text"
                               class="form-control form-control-lg search-input"
                               name="search"
                               value="@Context.Request.Query["search"]"
                               placeholder="Search by wine name, brand, grape variety, country, or category..."
                               style="padding-left: 50px; font-size: 1rem;" />
                    </div>
                </div>
                <div class="col-lg-2 col-md-3">
                    <div class="d-flex gap-2">
                        @if (!string.IsNullOrEmpty(Context.Request.Query["search"]))
                        {
                            <button type="submit" class="btn btn-wine btn-lg flex-fill">
                                <i class="bi bi-search"></i>
                            </button>
                            <a asp-action="Index" class="btn btn-outline-gold btn-lg">
                                <i class="bi bi-x-lg"></i>
                            </a>
                        }
                        else
                        {
                            <button type="submit" class="btn btn-wine btn-lg flex-fill">
                                <span>Search</span>
                            </button>
                        }
                    </div>
                </div>
            </div>

            @if (!string.IsNullOrEmpty(Context.Request.Query["search"]))
            {
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="bi bi-funnel me-1"></i>
                        Searching for: <strong style="color: var(--warm-gold);">@Context.Request.Query["search"]</strong>
                    </small>
                </div>
            }
        </form>
    </div>

    <!-- Results Section -->
    @if (Model == null || !Model.Any())
    {
        <div class="empty-state">
            <div style="text-align: center; padding: 80px 40px;">
                <div class="empty-icon mb-4">
                    <i class="bi bi-search"></i>
                </div>
                <h3 style="font-size: 2.5rem; font-weight: 400; margin-bottom: 20px; color: var(--deep-charcoal);" class="brand-serif">
                    No Wines Found
                </h3>
                <p class="text-muted mb-4" style="font-size: 1.05rem;">
                    Try a different search term or browse our complete collection
                </p>
                <a asp-action="Index" class="btn btn-wine">
                    <i class="bi bi-grid-3x3-gap me-2"></i>View All Wines
                </a>
            </div>
        </div>
    }
    else
    {
        <!-- Results Count -->
        <div class="mb-4">
            <p class="text-muted" style="font-size: 0.95rem;">
                @if (!string.IsNullOrEmpty(Context.Request.Query["search"]))
                {
                    <span>Found <strong>@Model.Count()</strong> wines matching your search</span>
                }
                else
                {
                    <span>Showing all <strong>@Model.Count()</strong> wines</span>
                }
            </p>
        </div>

        <div class="row g-4">
            @foreach (var wine in Model)
            {
                <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6">
                    <div class="wine-card scroll-reveal">
                        <div class="wine-card-image">
                            @if (!string.IsNullOrEmpty(wine.ImageUrl))
                            {
                                <img src="@wine.ImageUrl" alt="@wine.Name" />
                            }
                            else
                            {
                                <div class="wine-placeholder">
                                    <i class="bi bi-wine-glass"></i>
                                </div>
                            }

                            <div class="wine-badges">
                                @if (!string.IsNullOrEmpty(wine.Country))
                                {
                                    <span class="badge badge-wine">
                                        @wine.Country
                                    </span>
                                }
                                @if (!string.IsNullOrEmpty(wine.Category))
                                {
                                    <span class="badge badge-gold">@wine.Category</span>
                                }
                            </div>
                        </div>

                        <div class="wine-card-body">
                            <div class="wine-info-section">
                                <h5 class="wine-name">@wine.Name</h5>
                                <p class="wine-brand">@wine.Brand</p>

                                @if (wine.Year > 0)
                                {
                                    <p class="wine-year">@wine.Year</p>
                                }
                            </div>

                            <div class="wine-divider"></div>

                            <div class="wine-meta">
                                @if (!string.IsNullOrEmpty(wine.Grape))
                                {
                                    <span class="meta-item">
                                        <i class="bi bi-droplet"></i>@wine.Grape
                                    </span>
                                }
                                @if (!string.IsNullOrEmpty(wine.Region))
                                {
                                    <span class="meta-item">
                                        <i class="bi bi-geo"></i>@wine.Region
                                    </span>
                                }
                            </div>

                            <a asp-action="Details" asp-route-id="@wine.Id" class="btn btn-outline-gold w-100 mt-3">
                                <span>View Details</span>
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
