# -------- Build Stage --------
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /app

# Copy csproj and restore dependencies
COPY *.csproj ./
RUN dotnet restore

# Copy the rest of the code
COPY . ./

# Publish the app in Release mode
RUN dotnet publish -c Release -o /out

# -------- Runtime Stage --------
FROM mcr.microsoft.com/dotnet/aspnet:8.0
WORKDIR /app

# Copy published files from build stage
COPY --from=build /out .

# Set Render's required listening port
ENV ASPNETCORE_URLS=http://0.0.0.0:10000
EXPOSE 10000

# Optional: configure SQL Server connection string via environment variable
# You will set this in Render's dashboard under "Environment"
# Example:
# ENV ConnectionStrings__DefaultConnection="Server=<your-server>;Database=<your-db>;User Id=<user>;Password=<password>"

ENTRYPOINT ["dotnet", "BroxDistribution1.dll"]
